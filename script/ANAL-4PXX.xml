<?xml version="1.0" encoding="UTF-8"?>

<crawlegoProject version="1.0">
	<settings>
		<params>
		</params>
	</settings>

	<macros>
		<macro name="BASIS_DAY" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[20210905]]></param>
		</macro>
		<macro name="BUY_DAY" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[20210906]]></param>
		</macro>
		<macro name="SELL_DAY" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[20211014]]></param>
		</macro>
		<macro name="CASH" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[10000000]]></param>
		</macro>
		<macro name="PERIOD" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[ANNUAL]]></param>
		</macro>
		<macro name="IN_PATH" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[D:\work\jupyter\krx\output\index\]]></param>
		</macro>
		<macro name="OUT_PATH" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[D:\work\jupyter\krx\output\logicResult\]]></param>
		</macro>
		<macro name="TOP_N" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[20]]></param>
		</macro>
		<macro name="TOTAL_AMOUNT" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[25]]></param>
		</macro>
		<macro name="VOL_LIMIT" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[100000]]></param>
		</macro>
		<macro name="DO_SERVER" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[52.78.231.221]]></param>
		</macro>
		<macro name="BUY_YEAR" class="com.lge.crawlego.macro.ExpressionValue">
			<param name="expression"><![CDATA[SUBSTR('$(BUY_DAY)', 1, 4)]]></param>
		</macro>
		<macro name="SELL_YEAR" class="com.lge.crawlego.macro.ExpressionValue">
			<param name="expression"><![CDATA[SUBSTR('$(SELL_DAY)', 1, 4)]]></param>
		</macro>
		<macro name="YYYYMM" class="com.lge.crawlego.macro.ExpressionValue">
			<param name="expression"><![CDATA[SUBSTR('$(BASIS_DAY)', 1, 6)]]></param>
		</macro>
	</macros>



	<inputNodes>
		<inputNode name="EVAL_INDEX" type="FILE">
			<path><![CDATA[$(IN_PATH)$(PERIOD)-$(YYYYMM).txt]]></path>
			<columns>
				<column name="P_CODE" type="string" />
				<column name="TERM" type="string" />
				<column name="자산총계" type="real" />
				<column name="순자산" type="real" />
				<column name="부채총계" type="real" />
				<column name="자본총계" type="real" />
				<column name="현금및현금성자산" type="real" />
				<column name="유동자산" type="real" />
				<column name="비유동자산" type="real" />
				<column name="이자발생부채" type="real" />
				<column name="순부채" type="real" />
				<column name="CAPEX" type="real" />
				<column name="유동부채" type="real" />
				<column name="당기순이익_지배" type="real" />
				<column name="보통주" type="real" />
				<column name="매출액" type="real" />
				<column name="매출원가" type="real" />
				<column name="매출총이익" type="real" />
				<column name="영업이익" type="real" />
				<column name="당기순이익" type="real" />
				<column name="판매비와관리비" type="real" />
				<column name="법인세비용" type="real" />
				<column name="주당순이익_지배" type="real" />
				<column name="영업활동으로인한현금흐름" type="real" />
				<column name="배당금지급" type="real" />
				<column name="법인세납부" type="real" />
				<column name="투자활동으로인한현금흐름" type="real" />
				<column name="재무활동으로인한현금흐름" type="real" />
				<column name="현금및현금성자산의증가" type="real" />
				<column name="FCF" type="real" />
				<column name="ROA" type="real" />
				<column name="ROE" type="real" />
				<column name="부채비율" type="real" />
				<column name="순이익률" type="real" />
				<column name="영업이익률" type="real" />
				<column name="자본유보율" type="real" />
				<column name="현금배당성향" type="real" />
				<column name="현금배당수익률" type="real" />
				<column name="상장주식수" type="real" />
				<column name="시가총액" type="real" />
				<column name="시가총액_억" type="real" />
				<column name="EV" type="real" />
				<column name="현금흐름" type="real" />
				<column name="PER" type="real" />
				<column name="PBR" type="real" />
				<column name="PCR" type="real" />
				<column name="PSR" type="real" />
				<column name="EV/EBIT" type="real" />
				<column name="EV/EBITDA" type="real" />
				<column name="GP/A" type="real" />
				<column name="순부채비율" type="real" />
				<column name="유동비율" type="real" />
				<column name="배당수익률" type="real" />
				<column name="AdjFScore" type="real" />
				<column name="ROE증가율" type="real" />
				<column name="자산증가율" type="real" />
				<column name="자본증가율" type="real" />
				<column name="영업이익률증가율" type="real" />
				<column name="순이익률증가율" type="real" />
				<column name="매출액증가율" type="real" />
				<column name="영업이익증가율" type="real" />
				<column name="지배주주순이익증가율" type="real" />
			</columns>
			<ui>
				<position x="91" y="81" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>

		<inputNode name="BUY_PRICE" type="dataOn">
			<query><![CDATA[SELECT 날짜 "매수일", 종목코드, 종목명, 종가 "매수가", 시장구분, 거래대금, 거래량
  FROM PRICE.Y$(BUY_YEAR)
 WHERE 날짜 = '$(BUY_DAY)']]></query>
			<params>
				<param name="collection"><![CDATA[PRICE]]></param>
				<param name="password"><![CDATA[1234]]></param>
				<param name="port"><![CDATA[6362]]></param>
				<param name="server"><![CDATA[$(DO_SERVER)]]></param>
				<param name="user"><![CDATA[admin]]></param>
			</params>
			<columns>
				<column name="매수일" type="string" />
				<column name="종목코드" type="string" />
				<column name="종목명" type="string" />
				<column name="매수가" type="real" />
				<column name="시장구분" type="string" />
				<column name="거래대금" type="real" />
				<column name="거래량" type="real" />
			</columns>
			<ui>
				<position x="91" y="361" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>

		<inputNode name="SELL_PRICE" type="dataOn">
			<query><![CDATA[SELECT 날짜 "매도일", 종목코드, 종목명, 종가 "매도가"
  FROM PRICE.Y$(SELL_YEAR)
 WHERE 날짜 = '$(SELL_DAY)']]></query>
			<params>
				<param name="collection"><![CDATA[PRICE]]></param>
				<param name="password"><![CDATA[1234]]></param>
				<param name="port"><![CDATA[6362]]></param>
				<param name="server"><![CDATA[$(DO_SERVER)]]></param>
				<param name="user"><![CDATA[admin]]></param>
			</params>
			<columns>
				<column name="매도일" type="string" />
				<column name="종목코드" type="string" />
				<column name="종목명" type="string" />
				<column name="매도가" type="real" />
			</columns>
			<ui>
				<position x="92" y="531" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>
	</inputNodes>


	<dataProcessing>
		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[COMP_SIZE_RANK]]></dataSource>
			<dataGroupName><![CDATA[FILTER_BADS]]></dataGroupName>
			<ui>
				<position x="385" y="81" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[0.02 < {PBR} AND {PBR} < 4 AND {당기순이익} > 0 AND {부채비율} <= 150 AND {PCR} > 0]]></condition>
		</processingElem>

		<processingElem type="rank">
			<dataSource alias="A1"><![CDATA[NOT_KONEX]]></dataSource>
			<dataGroupName><![CDATA[COMP_SIZE_RANK]]></dataGroupName>
			<ui>
				<position x="257" y="81" />
				<description><![CDATA[]]></description>
			</ui>
			<rankColumns><![CDATA[시가총액]]></rankColumns>
			<prefix><![CDATA[RANK_ALL_]]></prefix>
			<usePercentage>true</usePercentage>
			<acsending>true</acsending>
		</processingElem>

		<processingElem type="rank">
			<dataSource alias="A1"><![CDATA[FILTER_BADS]]></dataSource>
			<dataGroupName><![CDATA[RANK_4IDX]]></dataGroupName>
			<ui>
				<position x="385" y="221" />
				<description><![CDATA[]]></description>
			</ui>
			<rankColumns><![CDATA[시가총액,PBR,PER,PSR,PCR]]></rankColumns>
			<prefix><![CDATA[RANK_]]></prefix>
			<usePercentage>true</usePercentage>
			<acsending>true</acsending>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[SCORING]]></dataSource>
			<dataGroupName><![CDATA[SMALL_SIZE]]></dataGroupName>
			<ui>
				<position x="259" y="358" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[{RANK_시가총액} <= $(TOTAL_AMOUNT) AND {거래량} >= $(VOL_LIMIT)]]></condition>
		</processingElem>

		<processingElem type="derived">
			<dataSource alias="A1"><![CDATA[RANK_4IDX]]></dataSource>
			<dataGroupName><![CDATA[SCORING]]></dataGroupName>
			<ui>
				<position x="385" y="358" />
				<description><![CDATA[]]></description>
			</ui>
			<addColumns>
				<derivedColumn name="S_PBR"><![CDATA[INT({RANK_PBR})]]></derivedColumn>
				<derivedColumn name="S_PER"><![CDATA[INT({RANK_PER})]]></derivedColumn>
				<derivedColumn name="S_PSR"><![CDATA[INT({RANK_PSR})]]></derivedColumn>
				<derivedColumn name="S_PCR"><![CDATA[INT({RANK_PCR})]]></derivedColumn>
				<derivedColumn name="RISK"><![CDATA[{S_PBR} + {S_PER} + {S_PSR} + {S_PCR}]]></derivedColumn>
			</addColumns>
		</processingElem>

		<processingElem type="merge">
			<dataSources>
				<dataSource alias="A1"><![CDATA[SMALL_SIZE]]></dataSource>
				<dataSource alias="A2"><![CDATA[BUY_PRICE]]></dataSource>
				<dataSource alias="A3"><![CDATA[SELL_PRICE]]></dataSource>
			</dataSources>
			<dataGroupName><![CDATA[MERGE_PRICE]]></dataGroupName>
			<ui>
				<position x="258" y="476" />
				<description><![CDATA[]]></description>
			</ui>
			<joinMethod>outer</joinMethod>
			<addKeyColumn>false</addKeyColumn>
			<equalKeys>
				<equalKey source="BUY_PRICE"><![CDATA[종목코드]]></equalKey>
				<equalKey source="SELL_PRICE"><![CDATA[종목코드]]></equalKey>
				<equalKey source="SMALL_SIZE"><![CDATA[P_CODE]]></equalKey>
			</equalKeys>
			<selectColumns>
				<columns source="BUY_PRICE"><![CDATA[매수일,종목명,매수가]]></columns>
				<columns source="SELL_PRICE"><![CDATA[매도일,매도가]]></columns>
				<columns source="SMALL_SIZE"><![CDATA[P_CODE,TERM,자산총계,시가총액_억,RANK_시가총액,RISK,거래량]]></columns>
			</selectColumns>
		</processingElem>

		<processingElem type="merge">
			<dataSources>
				<dataSource alias="A1"><![CDATA[EVAL_INDEX]]></dataSource>
				<dataSource alias="A2"><![CDATA[BUY_PRICE]]></dataSource>
			</dataSources>
			<dataGroupName><![CDATA[ADD_MARKET]]></dataGroupName>
			<ui>
				<position x="91" y="221" />
				<description><![CDATA[]]></description>
			</ui>
			<joinMethod>inner</joinMethod>
			<addKeyColumn>false</addKeyColumn>
			<equalKeys>
				<equalKey source="BUY_PRICE"><![CDATA[종목코드]]></equalKey>
				<equalKey source="EVAL_INDEX"><![CDATA[P_CODE]]></equalKey>
			</equalKeys>
			<selectColumns>
				<columns source="BUY_PRICE"><![CDATA[매수가,시장구분,거래대금,거래량]]></columns>
				<columns source="EVAL_INDEX"><![CDATA[*]]></columns>
			</selectColumns>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[ADD_MARKET]]></dataSource>
			<dataGroupName><![CDATA[NOT_KONEX]]></dataGroupName>
			<ui>
				<position x="257" y="221" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[{시장구분} <> 'KONEX' AND {매수가} > 2000]]></condition>
		</processingElem>

		<processingElem type="groupingValue">
			<dataSource alias="A1"><![CDATA[DIFF]]></dataSource>
			<dataGroupName><![CDATA[STAT]]></dataGroupName>
			<ui>
				<position x="860" y="217" />
				<description><![CDATA[]]></description>
			</ui>
			<groupingColumns><![CDATA[매수일, 매도일]]></groupingColumns>
			<generate>
				<column type="sum" delimiter=";" toName="R_SUM"><![CDATA[REVENUE]]></column>
			</generate>
		</processingElem>

		<processingElem type="derived">
			<dataSource alias="A1"><![CDATA[TOPN]]></dataSource>
			<dataGroupName><![CDATA[DIFF]]></dataGroupName>
			<ui>
				<position x="720" y="217" />
				<description><![CDATA[]]></description>
			</ui>
			<addColumns>
				<derivedColumn name="매수량"><![CDATA[FLOOR($(CASH) / $(TOP_N) / {매수가})]]></derivedColumn>
				<derivedColumn name="REVENUE"><![CDATA[({매도가} - {매수가}) * {매수량}]]></derivedColumn>
			</addColumns>
		</processingElem>

		<processingElem type="sort">
			<dataSource alias="A1"><![CDATA[MERGE_PRICE]]></dataSource>
			<dataGroupName><![CDATA[ORDERING]]></dataGroupName>
			<ui>
				<position x="580" y="477" />
				<description><![CDATA[]]></description>
			</ui>
			<sortColumns>
				<column order="ascending">RISK</column>
			</sortColumns>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[ORDERING]]></dataSource>
			<dataGroupName><![CDATA[TOPN]]></dataGroupName>
			<ui>
				<position x="580" y="217" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[@ROWNUM <= $(TOP_N)]]></condition>
		</processingElem>

		<processingElem type="orderAndFilter">
			<dataSource alias="A1"><![CDATA[DIFF]]></dataSource>
			<dataGroupName><![CDATA[RESULT_COLUMNS]]></dataGroupName>
			<ui>
				<position x="720" y="358" />
				<description><![CDATA[]]></description>
			</ui>
			<orderAndFilter>
				<column>P_CODE</column>
				<column>종목명</column>
				<column>자산총계</column>
				<column>시가총액_억</column>
				<column>매수일</column>
				<column>매수가</column>
				<column>매도일</column>
				<column>매도가</column>
				<column>거래량</column>
				<column>매수량</column>
				<column>RISK</column>
				<column>REVENUE</column>
			</orderAndFilter>
		</processingElem>
	</dataProcessing>

	<dataLoadings>
		<dataLoading name="SAVE_STAT" source="STAT" type="file">
			<filePath><![CDATA[$(OUT_PATH)$(BASIS_DAY)-STAT.txt]]></filePath>
			<remainFinFile><![CDATA[false]]></remainFinFile>
			<finFile><![CDATA[]]></finFile>
			<ui>
				<position x="1000" y="217" />
				<description><![CDATA[]]></description>
			</ui>
		</dataLoading>

		<dataLoading name="SAVE_ITEMS" source="RESULT_COLUMNS" type="file">
			<filePath><![CDATA[$(OUT_PATH)$(BASIS_DAY)-RESULT.txt]]></filePath>
			<remainFinFile><![CDATA[false]]></remainFinFile>
			<finFile><![CDATA[]]></finFile>
			<ui>
				<position x="870" y="358" />
				<description><![CDATA[]]></description>
			</ui>
		</dataLoading>

	</dataLoadings>
</crawlegoProject>
