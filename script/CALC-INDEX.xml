<?xml version="1.0" encoding="UTF-8"?>

<crawlegoProject version="1.0">
	<settings>
		<params>
		</params>
	</settings>

	<macros>
		<macro name="YEAR" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[2020]]></param>
		</macro>
		<macro name="DO_SERVER" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[13.124.29.70]]></param>
		</macro>
		<macro name="NEXT" class="com.lge.crawlego.macro.ExpressionValue">
			<param name="expression"><![CDATA[STR($(YEAR) + 1)]]></param>
		</macro>
		<macro name="PREV" class="com.lge.crawlego.macro.ExpressionValue">
			<param name="expression"><![CDATA[STR($(YEAR) - 1)]]></param>
		</macro>
	</macros>



	<inputNodes>
		<inputNode name="BSCFPL_DATA" type="dataOn">
			<query><![CDATA[SELECT *
  FROM KRX.ANNUAL_BSCFPL
 WHERE '$(YEAR)/04' <= TERM AND TERM < '$(NEXT)/04']]></query>
			<params>
				<param name="collection"><![CDATA[KRX]]></param>
				<param name="password"><![CDATA[1234]]></param>
				<param name="port"><![CDATA[6362]]></param>
				<param name="server"><![CDATA[$(DO_SERVER)]]></param>
				<param name="user"><![CDATA[admin]]></param>
			</params>
			<columns>
				<column name="P_CODE" type="string" />
				<column name="TERM" type="string" />
				<column name="자산총계" type="real" />
				<column name="유동자산" type="real" />
				<column name="현금및현금성자산" type="real" />
				<column name="재고자산" type="real" />
				<column name="비유동자산" type="real" />
				<column name="유형자산" type="real" />
				<column name="무형자산" type="real" />
				<column name="투자부동산" type="real" />
				<column name="투자자산" type="real" />
				<column name="순자산" type="real" />
				<column name="부채총계" type="real" />
				<column name="유동부채" type="real" />
				<column name="매입채무및기타채무" type="real" />
				<column name="이자발생부채" type="real" />
				<column name="순부채" type="real" />
				<column name="CAPEX" type="real" />
				<column name="자본총계" type="real" />
				<column name="지배주주지분" type="real" />
				<column name="자본금" type="real" />
				<column name="자본잉여금" type="real" />
				<column name="당기순이익_지배" type="real" />
				<column name="당기순이익_비지배" type="real" />
				<column name="비지배주주지분" type="real" />
				<column name="수권주식수" type="real" />
				<column name="주당금액" type="real" />
				<column name="발행주식수" type="real" />
				<column name="보통주" type="real" />
				<column name="매출액" type="real" />
				<column name="매출원가" type="real" />
				<column name="매출총이익" type="real" />
				<column name="영업이익" type="real" />
				<column name="당기순이익" type="real" />
				<column name="판매비와관리비" type="real" />
				<column name="감가상각비" type="real" />
				<column name="법인세비용차감전계속사업이익" type="real" />
				<column name="법인세비용" type="real" />
				<column name="기타포괄이익" type="real" />
				<column name="총포괄이익" type="real" />
				<column name="주당순이익" type="real" />
				<column name="주당순이익_지배" type="real" />
				<column name="영업활동으로인한현금흐름" type="real" />
				<column name="영업에서창출된현금흐름" type="real" />
				<column name="배당금수입" type="real" />
				<column name="배당금지급" type="real" />
				<column name="법인세납부" type="real" />
				<column name="투자활동으로인한현금흐름" type="real" />
				<column name="투자활동현금유입액" type="real" />
				<column name="투자활동현금유출액" type="real" />
				<column name="재무활동으로인한현금흐름" type="real" />
				<column name="재무활동현금유입액" type="real" />
				<column name="재무활동현금유출액" type="real" />
				<column name="현금및현금성자산의증가" type="real" />
				<column name="FCF" type="real" />
				<column name="ROA" type="real" />
				<column name="ROE" type="real" />
				<column name="부채비율" type="real" />
				<column name="세전계속사업이익" type="real" />
				<column name="순이익률" type="real" />
				<column name="영업이익률" type="real" />
				<column name="자본유보율" type="real" />
				<column name="현금배당성향" type="real" />
				<column name="현금배당수익률" type="real" />
			</columns>
			<ui>
				<position x="133" y="243" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>

		<inputNode name="STOCK_PRICE" type="dataOn">
			<query><![CDATA[SELECT *
  FROM PRICE.Y$(NEXT)]]></query>
			<params>
				<param name="collection"><![CDATA[KRX]]></param>
				<param name="password"><![CDATA[1234]]></param>
				<param name="port"><![CDATA[6362]]></param>
				<param name="server"><![CDATA[$(DO_SERVER)]]></param>
				<param name="user"><![CDATA[admin]]></param>
			</params>
			<columns>
				<column name="날짜" type="string" />
				<column name="종목코드" type="string" />
				<column name="종목명" type="string" />
				<column name="시장구분" type="string" />
				<column name="상장주식수" type="real" />
				<column name="시가총액" type="real" />
				<column name="시가" type="real" />
				<column name="고가" type="real" />
				<column name="저가" type="real" />
				<column name="종가" type="real" />
				<column name="등락률" type="real" />
				<column name="거래량" type="real" />
				<column name="거래대금" type="real" />
				<column name="외국인소진율" type="real" />
			</columns>
			<ui>
				<position x="133" y="393" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>

		<inputNode name="BSCFPL_PREV" type="dataOn">
			<query><![CDATA[SELECT *
  FROM KRX.ANNUAL_BSCFPL
 WHERE '$(PREV)/04' <= TERM AND TERM < '$(YEAR)/04']]></query>
			<params>
				<param name="collection"><![CDATA[KRX]]></param>
				<param name="password"><![CDATA[1234]]></param>
				<param name="port"><![CDATA[6362]]></param>
				<param name="server"><![CDATA[$(DO_SERVER)]]></param>
				<param name="user"><![CDATA[admin]]></param>
			</params>
			<columns>
				<column name="P_CODE" type="string" />
				<column name="TERM" type="string" />
				<column name="자산총계" type="real" />
				<column name="유동자산" type="real" />
				<column name="현금및현금성자산" type="real" />
				<column name="재고자산" type="real" />
				<column name="비유동자산" type="real" />
				<column name="유형자산" type="real" />
				<column name="무형자산" type="real" />
				<column name="투자부동산" type="real" />
				<column name="투자자산" type="real" />
				<column name="순자산" type="real" />
				<column name="부채총계" type="real" />
				<column name="유동부채" type="real" />
				<column name="매입채무및기타채무" type="real" />
				<column name="이자발생부채" type="real" />
				<column name="순부채" type="real" />
				<column name="CAPEX" type="real" />
				<column name="자본총계" type="real" />
				<column name="지배주주지분" type="real" />
				<column name="자본금" type="real" />
				<column name="자본잉여금" type="real" />
				<column name="당기순이익_지배" type="real" />
				<column name="당기순이익_비지배" type="real" />
				<column name="비지배주주지분" type="real" />
				<column name="수권주식수" type="real" />
				<column name="주당금액" type="real" />
				<column name="발행주식수" type="real" />
				<column name="보통주" type="real" />
				<column name="매출액" type="real" />
				<column name="매출원가" type="real" />
				<column name="매출총이익" type="real" />
				<column name="영업이익" type="real" />
				<column name="당기순이익" type="real" />
				<column name="판매비와관리비" type="real" />
				<column name="감가상각비" type="real" />
				<column name="법인세비용차감전계속사업이익" type="real" />
				<column name="법인세비용" type="real" />
				<column name="기타포괄이익" type="real" />
				<column name="총포괄이익" type="real" />
				<column name="주당순이익" type="real" />
				<column name="주당순이익_지배" type="real" />
				<column name="영업활동으로인한현금흐름" type="real" />
				<column name="영업에서창출된현금흐름" type="real" />
				<column name="배당금수입" type="real" />
				<column name="배당금지급" type="real" />
				<column name="법인세납부" type="real" />
				<column name="투자활동으로인한현금흐름" type="real" />
				<column name="투자활동현금유입액" type="real" />
				<column name="투자활동현금유출액" type="real" />
				<column name="재무활동으로인한현금흐름" type="real" />
				<column name="재무활동현금유입액" type="real" />
				<column name="재무활동현금유출액" type="real" />
				<column name="현금및현금성자산의증가" type="real" />
				<column name="FCF" type="real" />
				<column name="ROA" type="real" />
				<column name="ROE" type="real" />
				<column name="부채비율" type="real" />
				<column name="세전계속사업이익" type="real" />
				<column name="순이익률" type="real" />
				<column name="영업이익률" type="real" />
				<column name="자본유보율" type="real" />
				<column name="현금배당성향" type="real" />
				<column name="현금배당수익률" type="real" />
			</columns>
			<ui>
				<position x="133" y="90" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>
	</inputNodes>


	<dataProcessing>
		<processingElem type="merge">
			<dataSources>
				<dataSource alias="A1"><![CDATA[BSCFPL_DATA]]></dataSource>
				<dataSource alias="A2"><![CDATA[SEL_DATE]]></dataSource>
				<dataSource alias="A3"><![CDATA[PREV_PERIOD]]></dataSource>
			</dataSources>
			<dataGroupName><![CDATA[BS_AND_PRICE]]></dataGroupName>
			<ui>
				<position x="391" y="243" />
				<description><![CDATA[]]></description>
			</ui>
			<joinMethod>inner</joinMethod>
			<addKeyColumn>false</addKeyColumn>
			<equalKeys>
				<equalKey source="BSCFPL_DATA"><![CDATA[P_CODE]]></equalKey>
				<equalKey source="PREV_PERIOD"><![CDATA[P_CODE]]></equalKey>
				<equalKey source="SEL_DATE"><![CDATA[종목코드]]></equalKey>
			</equalKeys>
			<selectColumns>
				<columns source="BSCFPL_DATA"><![CDATA[*]]></columns>
				<columns source="PREV_PERIOD"><![CDATA[TERM_P,자산총계_P,순자산_P,보통주_P]]></columns>
				<columns source="SEL_DATE"><![CDATA[상장주식수,시가총액,종가]]></columns>
			</selectColumns>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[STOCK_PRICE]]></dataSource>
			<dataGroupName><![CDATA[SEL_DATE]]></dataGroupName>
			<ui>
				<position x="299" y="395" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[{날짜} = '$(NEXT)0105']]></condition>
		</processingElem>

		<processingElem type="derived">
			<dataSource alias="A1"><![CDATA[BS_AND_PRICE]]></dataSource>
			<dataGroupName><![CDATA[CALC_INDEX]]></dataGroupName>
			<ui>
				<position x="578" y="243" />
				<description><![CDATA[]]></description>
			</ui>
			<addColumns>
				<derivedColumn name="시가총액_억"><![CDATA[{시가총액} / 100000000]]></derivedColumn>
				<derivedColumn name="평균자기자본"><![CDATA[({순자산} + {순자산_P}) / 2]]></derivedColumn>
				<derivedColumn name="EV"><![CDATA[{시가총액_억} + {부채총계} - NVL({현금및현금성자산}, 0)]]></derivedColumn>
				<derivedColumn name="현금흐름"><![CDATA[NVL({영업활동으로인한현금흐름}, 0) + NVL({재무활동으로인한현금흐름}, 0)]]></derivedColumn>
				<derivedColumn name="PER"><![CDATA[{시가총액_억} / NVL({당기순이익_지배}, 1)]]></derivedColumn>
				<derivedColumn name="PBR"><![CDATA[{시가총액_억} / ({자산총계} - {부채총계})]]></derivedColumn>
				<derivedColumn name="PCR"><![CDATA[IIF(ISNULL({현금흐름}), 0, IIF({현금흐름} = 0, 0, {시가총액_억} / {현금흐름}))]]></derivedColumn>
				<derivedColumn name="PSR"><![CDATA[{시가총액_억} / {매출액}]]></derivedColumn>
				<derivedColumn name="EV/EBIT"><![CDATA[{EV} / {영업이익}]]></derivedColumn>
				<derivedColumn name="EV/EBITDA"><![CDATA[{EV} / ({영업이익} + {감가상각비})]]></derivedColumn>
				<derivedColumn name="GP/A"><![CDATA[IIF(NVL({매출액}, 0) = 0 OR NVL({매출원가}, 0) = 0 OR NVL({자산총계}, 0) = 0, -1, ({매출액} - {매출원가}) / {자산총계})]]></derivedColumn>
				<derivedColumn name="부채비율"><![CDATA[{부채총계} / {자본총계} * 100]]></derivedColumn>
				<derivedColumn name="유동비율"><![CDATA[{유동자산} / {유동부채} * 100]]></derivedColumn>
				<derivedColumn name="ROE"><![CDATA[{당기순이익} / {평균자기자본} * 100]]></derivedColumn>
				<derivedColumn name="ROA"><![CDATA[{당기순이익} / {자산총계} * 100]]></derivedColumn>
				<derivedColumn name="배당수익률"><![CDATA[IIF(ISNULL({배당금지급}), 0, - {배당금지급} * 100000 / {발행주식수} / {종가} * 100)]]></derivedColumn>
				<derivedColumn name="F-Score(Adj)"><![CDATA[IIF(NVL({보통주_P}, 0) >= {보통주}, 1, 0) + IIF({당기순이익} > 0, 1, 0) + IIF({영업활동으로인한현금흐름} > 0, 1, 0)]]></derivedColumn>
			</addColumns>
		</processingElem>

		<processingElem type="orderAndFilter">
			<dataSource alias="A1"><![CDATA[BSCFPL_PREV]]></dataSource>
			<dataGroupName><![CDATA[PREV_PERIOD]]></dataGroupName>
			<ui>
				<position x="299" y="91" />
				<description><![CDATA[]]></description>
			</ui>
			<orderAndFilter>
				<column>P_CODE</column>
				<column toName="TERM_P">TERM</column>
				<column toName="자산총계_P">자산총계</column>
				<column toName="순자산_P">순자산</column>
				<column toName="보통주_P">보통주</column>
			</orderAndFilter>
		</processingElem>
	</dataProcessing>
</crawlegoProject>
