<?xml version="1.0" encoding="UTF-8"?>

<crawlegoProject version="1.0">
	<settings>
		<params>
		</params>
	</settings>

	<macros>
		<macro name="COMP_CODE" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[124500]]></param>
		</macro>
		<macro name="FLATLIMIT" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[2.0]]></param>
		</macro>
		<macro name="OUT_PATH" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[/Users/TurboK/EclipseData/ToolSpace/chartX/data/]]></param>
		</macro>
		<macro name="OUT_PATH_WIN" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[D:\EclipseData\Andromeda\chartX\data\]]></param>
		</macro>
		<macro name="DO_SERVER" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[13.124.29.70]]></param>
		</macro>
		<macro name="BACKUP" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[002410  079370  066570 000660]]></param>
		</macro>
		<macro name="CYEAR" class="com.lge.crawlego.macro.ExpressionValue">
			<param name="expression"><![CDATA[DATETOSTR(NOW(), 'yyyy')]]></param>
		</macro>
		<macro name="PYEAR" class="com.lge.crawlego.macro.ExpressionValue">
			<param name="expression"><![CDATA[STR($(CYEAR) - 1)]]></param>
		</macro>
		<macro name="PPYEAR" class="com.lge.crawlego.macro.ExpressionValue">
			<param name="expression"><![CDATA[STR($(CYEAR) - 2)]]></param>
		</macro>
		<macro name="BEGIN" class="com.lge.crawlego.macro.ExpressionValue">
			<param name="expression"><![CDATA[DATETOSTR(NOW() - 550, 'yyyyMMdd')]]></param>
		</macro>
	</macros>



	<inputNodes>
		<inputNode name="PP_YEAR" type="dataOn">
			<query><![CDATA[SELECT 종목코드 "P_CODE", 종목명, 날짜, 시가, 고가, 저가, 종가
  FROM PRICE.Y$(PPYEAR)
 WHERE 종목코드 = '$(COMP_CODE)']]></query>
			<params>
				<param name="collection"><![CDATA[PRICE]]></param>
				<param name="password"><![CDATA[1234]]></param>
				<param name="port"><![CDATA[6362]]></param>
				<param name="server"><![CDATA[$(DO_SERVER)]]></param>
				<param name="user"><![CDATA[admin]]></param>
			</params>
			<columns>
				<column name="P_CODE" type="string" />
				<column name="종목명" type="string" />
				<column name="날짜" type="string" />
				<column name="시가" type="real" />
				<column name="고가" type="real" />
				<column name="저가" type="real" />
				<column name="종가" type="real" />
			</columns>
			<ui>
				<position x="56" y="57" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>

		<inputNode name="P_YEAR" type="dataOn">
			<query><![CDATA[SELECT 종목코드 "P_CODE", 종목명, 날짜, 시가, 고가, 저가, 종가
  FROM PRICE.Y$(PYEAR)
 WHERE 종목코드 = '$(COMP_CODE)']]></query>
			<params>
				<param name="collection"><![CDATA[PRICE]]></param>
				<param name="password"><![CDATA[1234]]></param>
				<param name="port"><![CDATA[6362]]></param>
				<param name="server"><![CDATA[$(DO_SERVER)]]></param>
				<param name="user"><![CDATA[admin]]></param>
			</params>
			<columns>
				<column name="P_CODE" type="string" />
				<column name="종목명" type="string" />
				<column name="날짜" type="string" />
				<column name="시가" type="real" />
				<column name="고가" type="real" />
				<column name="저가" type="real" />
				<column name="종가" type="real" />
			</columns>
			<ui>
				<position x="56" y="138" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>

		<inputNode name="C_YEAR" type="dataOn">
			<query><![CDATA[SELECT 종목코드 "P_CODE", 종목명, 날짜, 시가, 고가, 저가, 종가
  FROM PRICE.Y$(CYEAR)
 WHERE 종목코드 = '$(COMP_CODE)']]></query>
			<params>
				<param name="collection"><![CDATA[PRICE]]></param>
				<param name="password"><![CDATA[1234]]></param>
				<param name="port"><![CDATA[6362]]></param>
				<param name="server"><![CDATA[$(DO_SERVER)]]></param>
				<param name="user"><![CDATA[admin]]></param>
			</params>
			<columns>
				<column name="P_CODE" type="string" />
				<column name="종목명" type="string" />
				<column name="날짜" type="string" />
				<column name="시가" type="real" />
				<column name="고가" type="real" />
				<column name="저가" type="real" />
				<column name="종가" type="real" />
			</columns>
			<ui>
				<position x="56" y="213" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>
	</inputNodes>


	<dataProcessing>
		<processingElem type="sort">
			<dataSource alias="A1"><![CDATA[CONCERN]]></dataSource>
			<dataGroupName><![CDATA[SORTBYBASE]]></dataGroupName>
			<ui>
				<position x="163" y="49" />
				<description><![CDATA[]]></description>
			</ui>
			<sortColumns>
				<column order="ascending">DATE</column>
			</sortColumns>
		</processingElem>

		<processingElem type="append">
			<dataSources>
				<dataSource alias="A1"><![CDATA[PP_YEAR]]></dataSource>
				<dataSource alias="A2"><![CDATA[P_YEAR]]></dataSource>
				<dataSource alias="A3"><![CDATA[C_YEAR]]></dataSource>
			</dataSources>
			<dataGroupName><![CDATA[SN_PRICE]]></dataGroupName>
			<ui>
				<position x="56" y="312" />
				<description><![CDATA[]]></description>
			</ui>
			<appendMethod>first</appendMethod>
		</processingElem>

		<processingElem type="derived">
			<dataSource alias="A1"><![CDATA[SORTBYBASE]]></dataSource>
			<dataGroupName><![CDATA[GUESS_BUY]]></dataGroupName>
			<ui>
				<position x="291" y="50" />
				<description><![CDATA[]]></description>
			</ui>
			<addColumns>
				<derivedColumn name="DX"><![CDATA[@ROWNUM * 0.1]]></derivedColumn>
				<derivedColumn name="S_VALUE"><![CDATA[({LAST_P} - GETSTATISTICS(@{LAST_P}, "min")) / GETSTATISTICS(@{LAST_P}, "range")]]></derivedColumn>
				<derivedColumn name="SMV/20"><![CDATA[MOVINGAVG(@{S_VALUE}, 20)]]></derivedColumn>
				<derivedColumn name="MV/20"><![CDATA[ROUND( MOVINGAVG(@{LAST_P}, 20), 0 )]]></derivedColumn>
				<derivedColumn name="MV/60"><![CDATA[ROUND( MOVINGAVG(@{LAST_P}, 60), 0 )]]></derivedColumn>
				<derivedColumn name="MV/120"><![CDATA[ROUND( MOVINGAVG(@{LAST_P}, 120), 0 )]]></derivedColumn>
				<derivedColumn name="SLOPE/20"><![CDATA[IIF( @ROWNUM < 20, 0, LINEARSLOPE(@{DX}, @{SMV/20}, 4) )]]></derivedColumn>
				<derivedColumn name="RATIO/120"><![CDATA[{LAST_P} / {MV/120}]]></derivedColumn>
				<derivedColumn name="STD/20"><![CDATA[IIF( @ROWNUM < 30, 0, SQRT(MOVINGVAR(@{SMV/20} , 5)) * 1000 )]]></derivedColumn>
				<derivedColumn name="AVG/60"><![CDATA[IIF( @ROWNUM < 12, {MV/60}, (MOVINGSUM(@{MV/60}, 11) - {MV/60}) / 10 )]]></derivedColumn>
				<derivedColumn name="UP/DOWN"><![CDATA[IIF( @ROWNUM < 30, 0.5,
   IIF( {STD/20} < $(FLATLIMIT), 0.5,
      IIF( {SLOPE/20} > 0, 1, 0 )
   )
)]]></derivedColumn>
				<derivedColumn name="SUGGEST/BUY"><![CDATA[IIF( @ROWNUM < 60, 0,
  IIF( {UP/DOWN}[-1] = 0 AND {UP/DOWN} >= 0.5
       AND {AVG/60} >= {MV/60}
       AND {MV/60} / {MV/20} > 0.98
       AND MOVINGSUM(@{UP/DOWN}, 11) <= IIF({UP/DOWN} = 1, 1, 0.5)
     , 1, 0
  )
)]]></derivedColumn>
			</addColumns>
		</processingElem>

		<processingElem type="orderAndFilter">
			<dataSource alias="A1"><![CDATA[SN_PRICE]]></dataSource>
			<dataGroupName><![CDATA[NAME_HIDING]]></dataGroupName>
			<ui>
				<position x="163" y="311" />
				<description><![CDATA[]]></description>
			</ui>
			<orderAndFilter>
				<column>P_CODE</column>
				<column toName="DATE">날짜</column>
				<column toName="BEGIN_P">시가</column>
				<column toName="HIGH_P">고가</column>
				<column toName="LOW_P">저가</column>
				<column toName="LAST_P">종가</column>
			</orderAndFilter>
		</processingElem>

		<processingElem type="orderAndFilter">
			<dataSource alias="A1"><![CDATA[GUESS_BUY]]></dataSource>
			<dataGroupName><![CDATA[DISPLAY_COLUMNS]]></dataGroupName>
			<ui>
				<position x="451" y="50" />
				<description><![CDATA[]]></description>
			</ui>
			<orderAndFilter>
				<column>DATE</column>
				<column>SUGGEST/BUY</column>
				<column toName="PRICE">LAST_P</column>
				<column>MV/20</column>
				<column>MV/60</column>
				<column>SMV/20</column>
				<column>UP/DOWN</column>
			</orderAndFilter>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[NAME_HIDING]]></dataSource>
			<dataGroupName><![CDATA[CONCERN]]></dataGroupName>
			<ui>
				<position x="163" y="180" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[{DATE} >= '$(BEGIN)']]></condition>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[GUESS_BUY]]></dataSource>
			<dataGroupName><![CDATA[SETTED]]></dataGroupName>
			<ui>
				<position x="452" y="184" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[{SUGGEST/BUY}]]></condition>
		</processingElem>
	</dataProcessing>

	<dataLoadings>
		<dataLoading name="SAVE" source="DISPLAY_COLUMNS" type="file">
			<filePath><![CDATA[$(OUT_PATH)P$(COMP_CODE)B.pmd]]></filePath>
			<remainFinFile><![CDATA[false]]></remainFinFile>
			<finFile><![CDATA[]]></finFile>
			<ui>
				<position x="603" y="51" />
				<description><![CDATA[]]></description>
			</ui>
		</dataLoading>

		<dataLoading name="SAVE_SELECTED" source="SETTED" type="file">
			<filePath><![CDATA[$(OUT_PATH)S$(COMP_CODE).txt]]></filePath>
			<remainFinFile><![CDATA[false]]></remainFinFile>
			<finFile><![CDATA[]]></finFile>
			<ui>
				<position x="604" y="184" />
				<description><![CDATA[]]></description>
			</ui>
		</dataLoading>

	</dataLoadings>
</crawlegoProject>
