<?xml version="1.0" encoding="UTF-8"?>

<crawlegoProject version="1.0">
	<settings>
		<params>
		</params>
	</settings>

	<macros>
		<macro name="IN_PATH" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[D:\work\jupyter\krx\output\workingDay\]]></param>
		</macro>
		<macro name="OUT_PATH" class="com.lge.crawlego.macro.DefinedValue">
			<param name="value"><![CDATA[D:\work\jupyter\krx\resource\]]></param>
		</macro>
	</macros>



	<inputNodes>
		<inputNode name="WORKING_DAY" type="FILE">
			<path><![CDATA[$(IN_PATH)VD-*.txt]]></path>
			<columns>
				<column name="YYYYMMDD" type="string" />
			</columns>
			<ui>
				<position x="114" y="140" />
				<description><![CDATA[]]></description>
			</ui>
		</inputNode>
	</inputNodes>


	<dataProcessing>
		<processingElem type="derived">
			<dataSource alias="A1"><![CDATA[WORKING_DAY]]></dataSource>
			<dataGroupName><![CDATA[ADD_DF]]></dataGroupName>
			<ui>
				<position x="266" y="141" />
				<description><![CDATA[]]></description>
			</ui>
			<addColumns>
				<derivedColumn name="YYYYMM"><![CDATA[SUBSTR({YYYYMMDD}, 1, 6)]]></derivedColumn>
				<derivedColumn name="YYYY"><![CDATA[SUBSTR({YYYYMMDD}, 1, 4)]]></derivedColumn>
			</addColumns>
		</processingElem>

		<processingElem type="groupCount">
			<dataSource alias="A1"><![CDATA[ADD_DF]]></dataSource>
			<dataGroupName><![CDATA[GROUPING]]></dataGroupName>
			<ui>
				<position x="263" y="286" />
				<description><![CDATA[]]></description>
			</ui>
			<groupingColumns><![CDATA[YYYYMM]]></groupingColumns>
			<elementNumber><![CDATA[COUNT]]></elementNumber>
			<elementIndex><![CDATA[DAY_IDX]]></elementIndex>
			<generate>
				<column type="min" toName="FIRST_DAY"><![CDATA[YYYYMMDD]]></column>
				<column type="max" toName="LAST_DAY"><![CDATA[YYYYMMDD]]></column>
			</generate>
		</processingElem>

		<processingElem type="derived">
			<dataSource alias="A1"><![CDATA[GROUPING]]></dataSource>
			<dataGroupName><![CDATA[ADD_TYPE]]></dataGroupName>
			<ui>
				<position x="397" y="286" />
				<description><![CDATA[]]></description>
			</ui>
			<addColumns>
				<derivedColumn name="TYPE"><![CDATA[CASE(0, {DAY_IDX} = 1, 1, {DAY_IDX} = 2, 2, {DAY_IDX} = {COUNT} - 1, 3, {DAY_IDX} = {COUNT}, 4)]]></derivedColumn>
				<derivedColumn name="YMD2"><![CDATA[{YYYYMMDD}]]></derivedColumn>
				<derivedColumn name="YMD3"><![CDATA[IIF(@ROWNUM = @DATASIZE, {YYYYMMDD}, {YYYYMMDD}[1])]]></derivedColumn>
			</addColumns>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[ADD_TYPE]]></dataSource>
			<dataGroupName><![CDATA[SEL_SECOND]]></dataGroupName>
			<ui>
				<position x="536" y="86" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[{TYPE} = 2]]></condition>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[ADD_TYPE]]></dataSource>
			<dataGroupName><![CDATA[SEL_PREV]]></dataGroupName>
			<ui>
				<position x="540" y="213" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[{TYPE} = 3]]></condition>
		</processingElem>

		<processingElem type="merge">
			<dataSources>
				<dataSource alias="A1"><![CDATA[SEL_SECOND]]></dataSource>
				<dataSource alias="A2"><![CDATA[SEL_PREV]]></dataSource>
				<dataSource alias="A3"><![CDATA[SEL_LAST]]></dataSource>
			</dataSources>
			<dataGroupName><![CDATA[MERGE_ALL]]></dataGroupName>
			<ui>
				<position x="673" y="147" />
				<description><![CDATA[]]></description>
			</ui>
			<joinMethod>inner</joinMethod>
			<addKeyColumn>false</addKeyColumn>
			<equalKeys>
				<equalKey source="SEL_LAST"><![CDATA[YYYYMM]]></equalKey>
				<equalKey source="SEL_PREV"><![CDATA[YYYYMM]]></equalKey>
				<equalKey source="SEL_SECOND"><![CDATA[YYYYMM]]></equalKey>
			</equalKeys>
			<selectColumns>
				<columns source="SEL_LAST"><![CDATA[YMD3]]></columns>
				<columns source="SEL_PREV"><![CDATA[LAST_DAY,YMD2]]></columns>
				<columns source="SEL_SECOND"><![CDATA[YYYYMMDD,YYYYMM,FIRST_DAY]]></columns>
			</selectColumns>
		</processingElem>

		<processingElem type="orderAndFilter">
			<dataSource alias="A1"><![CDATA[MERGE_ALL]]></dataSource>
			<dataGroupName><![CDATA[LAST_RESULT]]></dataGroupName>
			<ui>
				<position x="821" y="146" />
				<description><![CDATA[]]></description>
			</ui>
			<orderAndFilter>
				<column>YYYYMM</column>
				<column>FIRST_DAY</column>
				<column toName="SECOND_DAY">YYYYMMDD</column>
				<column toName="PREV_DAY">YMD2</column>
				<column>LAST_DAY</column>
				<column toName="NEXT_DAY">YMD3</column>
			</orderAndFilter>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[ADD_TYPE]]></dataSource>
			<dataGroupName><![CDATA[SEL_ALL]]></dataGroupName>
			<ui>
				<position x="546" y="430" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[{TYPE} > 0]]></condition>
		</processingElem>

		<processingElem type="groupingValue">
			<dataSource alias="A1"><![CDATA[SEL_ALL]]></dataSource>
			<dataGroupName><![CDATA[GroupingValue_1]]></dataGroupName>
			<ui>
				<position x="682" y="431" />
				<description><![CDATA[]]></description>
			</ui>
			<groupingColumns><![CDATA[YYYY]]></groupingColumns>
			<generate>
				<column type="uniqueMerge" delimiter="','" toName="Q_DATE"><![CDATA[YYYYMMDD]]></column>
			</generate>
		</processingElem>

		<processingElem type="derived">
			<dataSource alias="A1"><![CDATA[GroupingValue_1]]></dataSource>
			<dataGroupName><![CDATA[Derived_1]]></dataGroupName>
			<ui>
				<position x="819" y="432" />
				<description><![CDATA[]]></description>
			</ui>
			<addColumns>
				<derivedColumn name="DATE_COND"><![CDATA["'" + {Q_DATE} + "'"]]></derivedColumn>
			</addColumns>
		</processingElem>

		<processingElem type="orderAndFilter">
			<dataSource alias="A1"><![CDATA[Derived_1]]></dataSource>
			<dataGroupName><![CDATA[ColumnOperator_1]]></dataGroupName>
			<ui>
				<position x="922" y="433" />
				<description><![CDATA[]]></description>
			</ui>
			<orderAndFilter>
				<column>YYYY</column>
				<column>DATE_COND</column>
			</orderAndFilter>
		</processingElem>

		<processingElem type="select">
			<dataSource alias="A1"><![CDATA[ADD_TYPE]]></dataSource>
			<dataGroupName><![CDATA[SEL_LAST]]></dataGroupName>
			<ui>
				<position x="588" y="311" />
				<description><![CDATA[]]></description>
			</ui>
			<condition><![CDATA[{TYPE} = 4]]></condition>
		</processingElem>
	</dataProcessing>

	<dataLoadings>
		<dataLoading name="SAVE" source="LAST_RESULT" type="file">
			<filePath><![CDATA[$(OUT_PATH)BASIS-DAYS.txt]]></filePath>
			<remainFinFile><![CDATA[false]]></remainFinFile>
			<finFile><![CDATA[]]></finFile>
			<ui>
				<position x="972" y="144" />
				<description><![CDATA[]]></description>
			</ui>
		</dataLoading>

		<dataLoading name="SAVE2" source="ColumnOperator_1" type="file">
			<filePath><![CDATA[$(OUT_PATH)BASIS-CONDITION.txt]]></filePath>
			<remainFinFile><![CDATA[false]]></remainFinFile>
			<finFile><![CDATA[]]></finFile>
			<ui>
				<position x="1052" y="430" />
				<description><![CDATA[]]></description>
			</ui>
		</dataLoading>

	</dataLoadings>
</crawlegoProject>
